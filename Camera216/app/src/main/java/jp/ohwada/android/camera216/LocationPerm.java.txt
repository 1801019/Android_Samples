/**
 * Camera2 Sample
 * LocationPerm
 * 2019-02-01 K.OHWADA
 */

package jp.ohwada.android.camera216;


import android.Manifest;
import android.app.Activity;
import android.content.Context;
import android.content.pm.PackageManager;
import android.support.v4.app.ActivityCompat;
import android.util.Log;



/**
 * class LocationPerm
 */
public class LocationPerm  {

    // debug
	private final static boolean D = true;
    private final static String TAG = "Camera2";
    private final static String TAG_SUB = "LocationPerm";


    /**
     * Request code for  Location permissions.
     */
    public static final int REQUEST_PERMISSIONS = 102;


    /**
     * Permissions required to Location
     */
    private static final String PERMISSION_LOCATION = Manifest.permission.ACCESS_FINE_LOCATION;

    private String[] PERMISSIONS = { PERMISSION_LOCATION };


    /**
     * Activity, Context
     */
    private Activity  mActivity;
    private Context mContext;


/**
 * constractor
 */
public LocationPerm(Activity activity)  {
    mActivity = activity;
    mContext = activity;
}


 /**
 * isGranted
  */
public  static boolean isGranted(Context context) {
    int perm = ActivityCompat.checkSelfPermission( context, PERMISSION_LOCATION );
    if ( perm == PackageManager.PERMISSION_GRANTED ) {
                return true;
    }
    return false;
} // isCaremaGranted


/**
 * onRequestPermissionsResult
 */
public boolean onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {

        return isGrantRequestPermissionsResult( requestCode, permissions, grantResults);

} // onRequestPermissionsResul


/**
 * isGrantRequestPermissionsResult
 */
private boolean isGrantRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {

        if ( requestCode != REQUEST_PERMISSIONS ) {
                return false;
        }
            boolean is_deny = false;
            for (int result : grantResults) {
                    if (result !=   PackageManager.PERMISSION_GRANTED) {
                        is_deny = true;
                    }
            } // for

    return  !is_deny;

} // isGrantRequestPermissionsResult


 /**
 * requestLocationPermissions
 */
public boolean requestLocationPermissions() {
    if ( !checkSelfPermissions() ) {
        // showPermissionConfirmationDialog();
        requestPermissions();
        return true;
    }
    return false;
} // requestLocationPermissions


/**
 * Requests permissions necessary to use camera and save pictures.
  */
private void requestPermissions() {
log_d("requestPermissions");
            ActivityCompat.requestPermissions( mActivity, PERMISSIONS, REQUEST_PERMISSIONS );

} // requestLocationPermissions


/**
 * checkSelfPermissions
  */
public boolean checkSelfPermissions() {
        for (String permission : PERMISSIONS) {
            if ( ActivityCompat.checkSelfPermission( mContext, permission )
                    != PackageManager.PERMISSION_GRANTED ) {
                return false;
            }
        }
        return true;
} // checkSelfPermissions



/**
 * shouldShowRationale
 * Gets whether you should show UI with rationale for requesting the permissions.
 *
  * @return True if the UI should be shown.
 */
public boolean shouldShowRationale() {
        for (String permission : PERMISSIONS) {
                if (ActivityCompat.shouldShowRequestPermissionRationale(mActivity, permission)) {
                        return true;
                } // if
        } // for
        return false;

} // shouldShowRationale


/**
 * write into logcat
 */ 
private void log_d( String msg ) {
	    if (D) Log.d( TAG, TAG_SUB + " " + msg );
} // log_d


} // class LocationPerm
